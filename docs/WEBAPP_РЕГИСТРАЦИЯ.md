# üåê Telegram WebApp –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Backend (–±–æ—Ç)

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ò–º–ø–æ—Ä—Ç `WebAppInfo` –∏–∑ `aiogram.types`
- WebApp –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö:
  - –ü—Ä–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–∏ –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`/start`)
  - –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω–æ–π –∑–∞—è–≤–∫–µ
  - –ü—Ä–∏ –æ—à–∏–±–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –±–æ—Ç–µ

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
InlineKeyboardButton(
    text="üåê –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (WebApp)", 
    web_app=WebAppInfo(url=f"{settings.FRONTEND_URL}/register?from=bot&telegram_id={user.id}")
)
```

### 2. Frontend

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `window.Telegram?.WebApp`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ WebApp
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram WebApp —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π hash
- Fallback –Ω–∞ –æ–±—ã—á–Ω—É—é URL-–∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–ö–æ–¥ –≤ `Register.tsx`:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ WebApp: `if (window.Telegram?.WebApp)`
- –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `initDataUnsafe.user`
- –ü–∞—Ä—Å–∏—Ç hash –∏–∑ `initDataString`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ `/registration/register`

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É WebApp –≤ –±–æ—Ç–µ**
   - Telegram –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç WebApp –≤–Ω—É—Ç—Ä–∏ –±–æ—Ç–∞
   - –ü–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `window.Telegram.WebApp.initDataUnsafe`

2. **–§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ WebApp API
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (id, first_name, username, etc.)
   - –ü–∞—Ä—Å–∏—Ç hash –∏–∑ `initDataString`

3. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è
   - –ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ `/registration/register` —Å hash
   - Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç hash —á–µ—Ä–µ–∑ `verify_telegram_auth`
   - –°–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –∑–∞—è–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥**
   - –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—É—á–∞–µ—Ç `access_token`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É
   - –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **WebApp –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–∞—Ö** (–Ω–µ –≤ –≥—Ä—É–ø–ø–∞—Ö)
2. **–î–ª—è —Ä–∞–±–æ—Ç—ã WebApp –Ω—É–∂–µ–Ω HTTPS** (–Ω–∞ Railway —ç—Ç–æ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
3. **Fallback –Ω–∞ –æ–±—ã—á–Ω—É—é URL-–∫–Ω–æ–ø–∫—É** –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

---

## üìù –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è WebApp –∫–Ω–æ–ø–∫–∏

1. **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (`/start`)
   - –ö–Ω–æ–ø–∫–∞: "üåê –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (WebApp)"
   - URL: `/register?from=bot&telegram_id={id}&username={username}&first_name={first_name}`

2. **–û—Ç–∫–ª–æ–Ω—ë–Ω–Ω–∞—è –∑–∞—è–≤–∫–∞**
   - –ö–Ω–æ–ø–∫–∞: "üåê –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ (WebApp)"
   - URL: `/register`
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: "üîó –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ" (–æ–±—ã—á–Ω–∞—è URL-–∫–Ω–æ–ø–∫–∞)

3. **–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –±–æ—Ç–µ**
   - –ö–Ω–æ–ø–∫–∞: "üåê –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ WebApp"
   - URL: `/register`

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞–∂–º–∏ `/start` (–µ—Å–ª–∏ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω)
3. –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "üåê –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (WebApp)"
4. –î–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è WebApp –≤–Ω—É—Ç—Ä–∏ –±–æ—Ç–∞
5. –ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
6. –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥

---

**–î–∞—Ç–∞:** 2025-01-09
