# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –Ω–∞ Railway

## –ü—Ä–æ–±–ª–µ–º–∞: 502 Bad Gateway

**–°–∏–º–ø—Ç–æ–º—ã:**
- Railway –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Application failed to respond"
- –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API
- –û—à–∏–±–∫–∞ "All connection attempts failed"

**–†–µ—à–µ–Ω–∏—è:**

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç
Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `PORT`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç –Ω–∞ `0.0.0.0` (–Ω–µ `127.0.0.1`)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `PORT` –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—É—Å–∫
–í `railway.json` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞:
```json
{
  "deploy": {
    "startCommand": "cd backend && python -m alembic upgrade head && python run_with_bot.py"
  }
}
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
–í Railway Dashboard ‚Üí Deployments ‚Üí View Logs:
- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `üöÄ Starting API server on 0.0.0.0:8080`
- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚úÖ DATABASE_URL –≤–∞–ª–∏–¥–µ–Ω`
- –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–í Railway Dashboard ‚Üí Variables:
- `ENVIRONMENT=production`
- `PORT` (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `DATABASE_URL` (–∏–∑ PostgreSQL —Å–µ—Ä–≤–∏—Å–∞)
- `TELEGRAM_BOT_TOKEN`

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint
–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
```bash
curl https://best-pr-system.up.railway.app/health
```
–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: `{"status": "ok"}`

---

## –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API

**–°–∏–º–ø—Ç–æ–º—ã:**
- `API call error: All connection attempts failed`
- –ë–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ `/start`

**–†–µ—à–µ–Ω–∏—è:**

### 1. –ë–æ—Ç –∂–¥—ë—Ç –∑–∞–ø—É—Å–∫–∞ API
–¢–µ–ø–µ—Ä—å –±–æ—Ç –∂–¥—ë—Ç 3 —Å–µ–∫—É–Ω–¥—ã –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API.

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API_URL
–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `http://localhost:8080` –Ω–∞ Railway (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∑–∞–ø—Ä–æ—Å).
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π URL, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
```
API_URL=https://best-pr-system.up.railway.app
```

### 3. –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç
–ï—Å–ª–∏ API –º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, —É–≤–µ–ª–∏—á—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É –≤ `run_with_bot.py`:
```python
await asyncio.sleep(5)  # –í–º–µ—Å—Ç–æ 3
```

---

## –ü—Ä–æ–±–ª–µ–º–∞: –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- `type "notification_type" does not exist`
- `UndefinedObjectError`

**–†–µ—à–µ–Ω–∏—è:**

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π
–ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ: 001 ‚Üí 002 ‚Üí 003 ‚Üí 004 ‚Üí 005

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î
–í Railway –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
```sql
SELECT * FROM alembic_version;
```

### 3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Railway CLI:
```bash
railway run cd backend && python -m alembic upgrade head
```

---

## –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Railway:**
   - Dashboard ‚Üí Deployments ‚Üí View Logs
   - –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint:**
   ```bash
   curl https://best-pr-system.up.railway.app/health
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ docs:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `https://best-pr-system.up.railway.app/docs`
   - –ï—Å–ª–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è - –ø—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–ø—É—Å–∫–æ–º API

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
   - `ENVIRONMENT=production` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞

---

**–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Railway
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
