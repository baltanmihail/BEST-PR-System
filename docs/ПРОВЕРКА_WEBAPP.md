# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ WebApp —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## üéØ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥ –±–æ—Ç–∞

**–§–∞–π–ª:** `backend/bot/handlers.py`

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```python
from aiogram.types import ..., WebAppInfo

# –í –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö:
InlineKeyboardButton(
    text="üåê –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (WebApp)", 
    web_app=WebAppInfo(url=f"{settings.FRONTEND_URL}/register")
)
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–§–∞–π–ª:** `backend/app/config.py` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Railway

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```env
FRONTEND_URL=https://best-pr-system.up.railway.app
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å –≤ –±–æ—Ç–µ

1. **–û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –≤ Telegram** (–ª–∏—á–Ω—ã–π —á–∞—Ç, –Ω–µ –≥—Ä—É–ø–ø–∞!)
2. **–û—Ç–ø—Ä–∞–≤—å `/start`** (–µ—Å–ª–∏ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω)
3. **–î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞:** "üåê –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (WebApp)"
4. **–ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É**
5. **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
   - ‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è WebApp **–≤–Ω—É—Ç—Ä–∏ Telegram** (–Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ!)
   - ‚úÖ –í–∏–¥–Ω–∞ —Ñ–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   - ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

**–û—Ç–∫—Ä–æ–π DevTools (F12) –≤ WebApp –∏ –ø—Ä–æ–≤–µ—Ä—å:**

```javascript
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å true
console.log('WebApp available:', !!window.Telegram?.WebApp)

// –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
console.log('User data:', window.Telegram?.WebApp?.initDataUnsafe?.user)

// –î–æ–ª–∂–µ–Ω –±—ã—Ç—å hash
console.log('Has hash:', !!window.Telegram?.WebApp?.initData)
```

---

## üîç –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–æ–ø–æ–∫ –≤ –±–æ—Ç–µ

**–ú–µ—Å—Ç–∞, –≥–¥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å WebApp –∫–Ω–æ–ø–∫–∏:**

1. **–ü—Ä–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–∏ –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (`/start`)
   - –ö–Ω–æ–ø–∫–∞: "üåê –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (WebApp)"
   - URL: `/register?from=bot&telegram_id={id}&...`

2. **–ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω–æ–π –∑–∞—è–≤–∫–µ**
   - –ö–Ω–æ–ø–∫–∞: "üåê –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ (WebApp)"
   - URL: `/register`

3. **–ü—Ä–∏ –æ—à–∏–±–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –±–æ—Ç–µ**
   - –ö–Ω–æ–ø–∫–∞: "üåê –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ WebApp"
   - URL: `/register`

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

**–§–∞–π–ª:** `frontend/src/pages/Register.tsx`

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```typescript
if (window.Telegram?.WebApp) {
  const tg = window.Telegram.WebApp
  const initDataUnsafe = tg.initDataUnsafe
  // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ç–∫–µ–Ω–¥–∞

**–§–∞–π–ª:** `backend/app/api/registration.py`

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ hash —á–µ—Ä–µ–∑ verify_telegram_auth
if not verify_telegram_auth(auth_data):
    raise HTTPException(...)
```

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–Ω–æ–ø–∫–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç WebApp

**–ü—Ä–∏—á–∏–Ω—ã:**
- ‚ùå URL –Ω–µ HTTPS (–Ω—É–∂–µ–Ω HTTPS!)
- ‚ùå URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- ‚ùå –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å `FRONTEND_URL` –≤ Railway (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `https://...`)
2. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —ç—Ç–æ–º—É URL
3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –±–æ—Ç–∞ –≤ Railway

### –ü—Ä–æ–±–ª–µ–º–∞: WebApp –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
- ‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–µ —á–µ—Ä–µ–∑ WebApp –∫–Ω–æ–ø–∫—É
- ‚ùå Telegram WebApp API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ –±–æ—Ç–µ (–Ω–µ —á–µ—Ä–µ–∑ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É)
2. –ü—Ä–æ–≤–µ—Ä—å –≤ –∫–æ–Ω—Å–æ–ª–∏: `window.Telegram?.WebApp` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "Button_type_invalid"

**–ü—Ä–∏—á–∏–Ω–∞:**
- ‚ùå WebApp –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ **–ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–∞—Ö** (–Ω–µ –≤ –≥—Ä—É–ø–ø–∞—Ö!)

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π WebApp –∫–Ω–æ–ø–∫–∏ —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö —Å –±–æ—Ç–æ–º
- –í –≥—Ä—É–ø–ø–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–π –æ–±—ã—á–Ω—ã–µ URL-–∫–Ω–æ–ø–∫–∏

---

## üìù –ß–µ–∫–ª–∏—Å—Ç

- [ ] WebApp –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ–¥ –±–æ—Ç–∞
- [ ] `FRONTEND_URL` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Railway
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS
- [ ] –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç WebApp –≤–Ω—É—Ç—Ä–∏ Telegram
- [ ] –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ WebApp

---

## üß™ –¢–µ—Å—Ç-–∫–µ–π—Å—ã

### –¢–µ—Å—Ç 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ WebApp

1. –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å `/start` (–µ—Å–ª–∏ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω)
3. –ù–∞–∂–º–∏ "üåê –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (WebApp)"
4. –ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
5. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –û—Ç–∫—Ä–æ–π WebApp —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É
2. –û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
3. –ü—Ä–æ–≤–µ—Ä—å: `window.Telegram?.WebApp?.initDataUnsafe?.user`
4. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (id, first_name, etc.)

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ hash

1. –û—Ç–∫—Ä–æ–π WebApp —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É
2. –û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
3. –ü—Ä–æ–≤–µ—Ä—å: `window.Telegram?.WebApp?.initData`
4. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç—Ä–æ–∫–∞ —Å hash

---

**–î–∞—Ç–∞:** 2025-01-09
